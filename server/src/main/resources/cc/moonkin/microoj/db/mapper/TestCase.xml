<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.1//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cc.moonkin.microoj.db.mapper.TestCaseMapper">

    <insert id="multiAdd" parameterType="java.util.List" useGeneratedKeys="true"
            keyProperty="id">
        INSERT INTO test_case(problem_id, weight, input, output)
        VALUES
        <foreach collection="list" item="item" separator=",">
            (#{item.problemId}, #{item.weight}, #{item.input}, #{item.output})
        </foreach>
    </insert>

    <update id="update" parameterType="cc.moonkin.microoj.data.TestCase">
        UPDATE test_case
        <set>
            <trim suffixOverrides=",">
                <if test="problemId != null">problem_id = #{problemId},</if>
                <if test="weight != null">weight = #{weight},</if>
                <if test="input != null">input = #{input},</if>
                <if test="output != null">output = #{output}</if>
            </trim>
        </set>
        WHERE id = #{id}
    </update>

    <update id="delete">
        UPDATE test_case
        SET deleted = 1
        WHERE id = #{id}
    </update>

    <update id="recover">
        UPDATE test_case
        SET deleted = 0
        WHERE id = #{id}
    </update>

    <select id="get" resultType="cc.moonkin.microoj.data.TestCase">
        SELECT
        *
        FROM test_case
        WHERE id = #{id}
        <if test="!deleted">AND deleted = 0</if>
    </select>

    <select id="getByProblemId" resultType="cc.moonkin.microoj.data.TestCase">
        SELECT
        *
        FROM test_case
        <if test="!deleted">WHERE deleted = 0</if>
    </select>

</mapper>